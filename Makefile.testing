# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HolographicMemory Testing Framework
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Configuration                                                               â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# Python Environment
PY              ?= python3
PIP             ?= $(PY) -m pip
VENV_DIR        ?= venv313
VENV_PY         ?= $(shell pwd)/$(VENV_DIR)/bin/python
VENV_PIP        ?= $(VENV_PY) -m pip

# Directories
TEST_DIR        ?= tests
REPORTS_DIR     ?= tests/reports
LOGS_DIR        ?= logs
COVERAGE_DIR    ?= $(REPORTS_DIR)/coverage
HTML_DIR        ?= $(REPORTS_DIR)/html
JUNIT_DIR       ?= $(REPORTS_DIR)/junit
PERF_DIR        ?= $(REPORTS_DIR)/performance

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Test Arguments                                                              â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PYTEST_ARGS     ?= -v --tb=short --strict-markers
COVERAGE_ARGS   ?= --cov=services --cov-report=html:$(COVERAGE_DIR) --cov-report=xml:$(REPORTS_DIR)/coverage.xml
HTML_ARGS       ?= --html=$(HTML_DIR)/pytest_report.html --self-contained-html
JUNIT_ARGS      ?= --junitxml=$(JUNIT_DIR)/junit.xml
PERF_ARGS       ?= --benchmark-only --benchmark-save=performance --benchmark-save-data

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Colors                                                                      â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RED     = \033[0;31m
GREEN   = \033[0;32m
YELLOW  = \033[1;33m
BLUE    = \033[0;34m
PURPLE  = \033[0;35m
CYAN    = \033[0;36m
NC      = \033[0m

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Main Test Targets                                                           â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

.PHONY: test test-all test-unit test-integration test-e2e test-performance test-coverage test-html test-junit test-benchmark test-clean test-setup test-report test-open test-quick test-full test-ci

test: test-setup test-quick
	@echo "$(GREEN)âœ… Quick test suite completed$(NC)"

test-all: test-setup test-full test-report test-open
	@echo "$(GREEN)âœ… Complete test suite completed$(NC)"

test-quick: test-unit test-coverage
	@echo "$(GREEN)âœ… Quick tests completed$(NC)"

test-full: test-unit test-integration test-e2e test-performance test-benchmark
	@echo "$(GREEN)âœ… Full test suite completed$(NC)"

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Test Categories                                                             â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

test-unit:
	@echo "$(BLUE)ğŸ§ª Running unit tests...$(NC)"
	@mkdir -p $(LOGS_DIR) $(REPORTS_DIR)
	@$(VENV_PY) -m pytest $(TEST_DIR)/unit/ $(PYTEST_ARGS) $(COVERAGE_ARGS) $(HTML_ARGS) $(JUNIT_ARGS) \
		--log-file=$(LOGS_DIR)/unit_tests.log --log-level=INFO \
		--capture=no --color=yes
	@echo "$(GREEN)âœ… Unit tests completed$(NC)"

test-integration:
	@echo "$(BLUE)ğŸ”— Running integration tests...$(NC)"
	@mkdir -p $(LOGS_DIR) $(REPORTS_DIR)
	@$(VENV_PY) -m pytest $(TEST_DIR)/integration/ $(PYTEST_ARGS) $(HTML_ARGS) \
		--log-file=$(LOGS_DIR)/integration_tests.log --log-level=INFO \
		--capture=no --color=yes
	@echo "$(GREEN)âœ… Integration tests completed$(NC)"

test-e2e:
	@echo "$(BLUE)ğŸŒ Running end-to-end tests...$(NC)"
	@mkdir -p $(LOGS_DIR) $(REPORTS_DIR)
	@$(VENV_PY) -m pytest $(TEST_DIR)/e2e/ $(PYTEST_ARGS) $(HTML_ARGS) \
		--log-file=$(LOGS_DIR)/e2e_tests.log --log-level=INFO \
		--capture=no --color=yes
	@echo "$(GREEN)âœ… End-to-end tests completed$(NC)"

test-performance:
	@echo "$(BLUE)âš¡ Running performance tests...$(NC)"
	@mkdir -p $(LOGS_DIR) $(REPORTS_DIR) $(PERF_DIR)
	@$(VENV_PY) -m pytest $(TEST_DIR)/performance/ $(PYTEST_ARGS) $(PERF_ARGS) \
		--log-file=$(LOGS_DIR)/performance_tests.log --log-level=INFO \
		--capture=no --color=yes
	@echo "$(GREEN)âœ… Performance tests completed$(NC)"

test-benchmark:
	@echo "$(BLUE)ğŸ“Š Running benchmark tests...$(NC)"
	@mkdir -p $(LOGS_DIR) $(REPORTS_DIR)
	@$(VENV_PY) -m pytest $(TEST_DIR)/benchmarks/ $(PYTEST_ARGS) $(PERF_ARGS) \
		--log-file=$(LOGS_DIR)/benchmark_tests.log --log-level=INFO \
		--capture=no --color=yes
	@echo "$(GREEN)âœ… Benchmark tests completed$(NC)"

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Coverage & Reporting                                                        â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

test-coverage:
	@echo "$(BLUE)ğŸ“ˆ Generating coverage report...$(NC)"
	@mkdir -p $(COVERAGE_DIR)
	@$(VENV_PY) -m pytest $(TEST_DIR)/unit/ $(COVERAGE_ARGS) \
		--log-file=$(LOGS_DIR)/coverage.log --log-level=INFO
	@echo "$(GREEN)âœ… Coverage report generated$(NC)"

test-html:
	@echo "$(BLUE)ğŸ“„ Generating HTML test report...$(NC)"
	@mkdir -p $(HTML_DIR)
	@$(VENV_PY) -m pytest $(TEST_DIR)/ $(PYTEST_ARGS) $(HTML_ARGS) \
		--log-file=$(LOGS_DIR)/html_report.log --log-level=INFO
	@echo "$(GREEN)âœ… HTML test report generated$(NC)"

test-junit:
	@echo "$(BLUE)ğŸ“‹ Generating JUnit XML report...$(NC)"
	@mkdir -p $(JUNIT_DIR)
	@$(VENV_PY) -m pytest $(TEST_DIR)/ $(PYTEST_ARGS) $(JUNIT_ARGS) \
		--log-file=$(LOGS_DIR)/junit_report.log --log-level=INFO
	@echo "$(GREEN)âœ… JUnit XML report generated$(NC)"

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Setup & Cleanup                                                             â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

test-setup:
	@echo "$(YELLOW)ğŸ”§ Setting up test environment...$(NC)"
	@mkdir -p $(LOGS_DIR) $(REPORTS_DIR) $(COVERAGE_DIR) $(HTML_DIR) $(JUNIT_DIR) $(PERF_DIR)
	@$(VENV_PIP) install pytest pytest-cov pytest-html pytest-benchmark pytest-xdist
	@$(VENV_PIP) install pytest-mock pytest-asyncio pytest-timeout
	@echo "$(GREEN)âœ… Test environment ready$(NC)"

test-clean:
	@echo "$(YELLOW)ğŸ§¹ Cleaning test artifacts...$(NC)"
	@rm -rf $(LOGS_DIR) $(REPORTS_DIR) .pytest_cache .coverage
	@rm -rf **/__pycache__ **/*.pyc
	@echo "$(GREEN)âœ… Test artifacts cleaned$(NC)"

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Report Generation & Viewing                                                â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

test-report:
	@echo "$(BLUE)ğŸ“Š Generating comprehensive test report...$(NC)"
	@mkdir -p $(HTML_DIR)
	@$(VENV_PY) scripts/generate_test_summary.py
	@echo "$(GREEN)âœ… Test report generated$(NC)"

test-open:
	@echo "$(BLUE)ğŸŒ Opening unified test dashboard in Chrome...$(NC)"
	@echo "$(CYAN)ğŸ“Š Opening dashboard with embedded tabs...$(NC)"
	@$(VENV_PY) scripts/generate_test_summary.py
	@open -a "Google Chrome" "file://$(shell pwd)/$(REPORTS_DIR)/index.html" 2>/dev/null || \
		open -a "Chrome" "file://$(shell pwd)/$(REPORTS_DIR)/index.html" 2>/dev/null || \
		echo "$(YELLOW)âš ï¸  Chrome not found, please open $(REPORTS_DIR)/index.html manually$(NC)"
	@echo "$(GREEN)âœ… Unified test dashboard opened in Chrome$(NC)"

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ CI/CD Integration                                                          â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

test-ci:
	@echo "$(BLUE)ğŸ¤– Running CI test suite...$(NC)"
	@$(MAKE) test-setup
	@$(VENV_PY) -m pytest $(TEST_DIR)/ $(PYTEST_ARGS) $(COVERAGE_ARGS) $(JUNIT_ARGS) \
		--log-file=$(LOGS_DIR)/ci_tests.log --log-level=INFO \
		--capture=no --color=yes --maxfail=5
	@echo "$(GREEN)âœ… CI test suite completed$(NC)"

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Help                                                                        â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

test-help:
	@echo "$(CYAN)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(CYAN)â•‘                HolographicMemory Testing Framework           â•‘$(NC)"
	@echo "$(CYAN)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(YELLOW)Quick Commands:$(NC)"
	@echo "  $(GREEN)make test$(NC)        - Quick test suite (unit + coverage)"
	@echo "  $(GREEN)make test-all$(NC)    - Complete test suite with reports"
	@echo "  $(GREEN)make test-open$(NC)   - Open reports in Chrome"
	@echo ""
	@echo "$(YELLOW)Test Categories:$(NC)"
	@echo "  $(GREEN)test-unit$(NC)        - Unit tests only"
	@echo "  $(GREEN)test-integration$(NC) - Integration tests only"
	@echo "  $(GREEN)test-e2e$(NC)         - End-to-end tests only"
	@echo "  $(GREEN)test-performance$(NC) - Performance tests only"
	@echo ""
	@echo "$(YELLOW)Reports & Utilities:$(NC)"
	@echo "  $(GREEN)test-coverage$(NC)    - Generate coverage report"
	@echo "  $(GREEN)test-report$(NC)      - Generate test summary"
	@echo "  $(GREEN)test-clean$(NC)       - Clean test artifacts"
	@echo "  $(GREEN)test-setup$(NC)       - Setup test environment"
	@echo ""
	@echo "$(YELLOW)Report Locations:$(NC)"
	@echo "  ğŸ“Š $(COVERAGE_DIR)/index.html"
	@echo "  ğŸ“„ $(HTML_DIR)/pytest_report.html"
	@echo "  ğŸ  $(REPORTS_DIR)/index.html"
